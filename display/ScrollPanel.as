package com.kaka.display{	import com.kaka.display.BasePanel;	import com.koolou.Event.KEvent;	import flash.display.MovieClip;	import flash.events.Event;	import flash.events.MouseEvent;	import flash.geom.Rectangle;	import com.greensock.TweenMax;	import com.greensock.easing.Expo;	import flash.display.Stage	/**	 * ...	 * @author kaka	 */	public class ScrollPanel extends BasePanel	{		private var _scrollbar:MovieClip;		private var _scrolltrack:MovieClip;		private var _contentbody:MovieClip;		private var _contentmask:MovieClip;		private var _speed:Number ;		private var sd:Number;		private var sr:Number;		private var cd:Number;		private var cr:Number;		private var new_y:Number;		private var drag_area:Rectangle;		private var _stage:Stage		public function ScrollPanel(scrollbar:MovieClip, scrolltrack:MovieClip,contentbody:MovieClip,contentmask:MovieClip,speed:Number) 		{			if( speed < 0 || speed > 1 ) speed = 0.50;			_speed=speed;			_scrollbar = scrollbar;			_scrollbar.buttonMode=true;			_scrolltrack = scrolltrack;			_contentbody = contentbody;			_contentmask = contentmask;			_contentbody.mask = _contentmask						sr = Math.round(_contentmask.height / _contentbody.height);			//_scrollbar.height = _scrolltrack.height * sr;				sd = Math.round(_scrolltrack.height - _scrollbar.height);			cd = Math.round(_contentbody.height - _contentmask.height);			cr = Math.round(cd / sd*1.01);						drag_area = new Rectangle(_scrollbar.x, _scrollbar.y, 0, _scrolltrack.height - _scrollbar.height);			_contentbody.x = _contentmask.x;			_contentbody.y = _contentmask.y;					_scrollbar.x = _scrolltrack.x;			_scrollbar.y = _scrolltrack.y;			if ( _contentbody.height <= _contentmask.height )			{				_scrollbar.visible = _scrolltrack.visible = false;			}								addEventListener(Event.ADDED_TO_STAGE,init)		}		private function init(e:Event)		{			_stage=stage			_scrollbar.addEventListener(MouseEvent.MOUSE_DOWN, drag)			_scrollbar.addEventListener(MouseEvent.MOUSE_UP, nodrag)			stage.addEventListener(Event.MOUSE_LEAVE,up)					}		private function drag(e:MouseEvent)		{			e.target.startDrag(false, drag_area);			_stage.addEventListener(MouseEvent.MOUSE_UP, up);			_stage.addEventListener(Event.ENTER_FRAME, onenter );		}		private function nodrag(e:MouseEvent)		{			e.target.stopDrag()			_stage.removeEventListener(MouseEvent.MOUSE_UP, up);			_stage.removeEventListener(Event.ENTER_FRAME, onenter );		}		private function up(e:Event)		{			_scrollbar.stopDrag()			if(_stage.hasEventListener(Event.ENTER_FRAME))			{				_stage.removeEventListener(Event.ENTER_FRAME, onenter);			}					}		private function onenter(e:Event)		{			//new_y=_contentmask.y+_scrolltrack.y*cr-_scrollbar.y*cr			//_contentbody.y +=(new_y-_contentbody.y)*sr			_contentbody.y=Math.round(_contentmask.y)-Math.round((_scrollbar.y-_contentmask.y)/sd*cd)-5		}		}}